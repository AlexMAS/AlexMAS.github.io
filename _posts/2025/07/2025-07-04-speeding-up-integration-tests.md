---
layout: post
title: Ускорение интеграционных тестов
date: 2025-07-04
tags: dev db tip
categories: post
thumbnail: /assets/img/blog/2025/2025-07-04-test-pyramid.png
---

Недавно я узнал об инструменте [Zonky](https://github.com/zonkyio/embedded-database-spring-test), который на одном из проектов позволил ускорить выполнение интеграционных тестов в среднем в 3.5-4 раза. Делать практически ничего не пришлось: подключил зависимость и добавил аннотацию.

![](/assets/img/blog/2025/2025-07-04-test-pyramid.png)

## Об инструменте

Если вы испытываете проблемы с долгим выполнением интеграционных тестов, пишете на Java/Kotlin, используете Spring (не обязательно) и Testcontainers, то сможете за пару часов повторить мой опыт и проверить эффективность использования Zonky в своём проекте.

> У меня есть страсть — узнавать происхождение необычных слов. Оказалось, что *зонки* — искусственно созданные виды непарнокопытных. Гибрид зебры и осла, выведенный в XIX веке. На вид они мультяшно-миловидные, но свободолюбивые и упрямые. Впрочем, это уже совсем другая история. :)

Перед запуском интеграционных тестов Zonky создаёт и настраивает указанную embedded-базу данных и регистрирует её в качестве источника. Заявлена поддержка PostgreSQL, MSSQL, MySQL, MariaDB, H2, HSQLDB и Derby. Библиотека интегрирована со Spring, генераторами схемы данных Liquibase и Flyway, может работать без Docker (проверено для PostgreSQL). В основе реализации два ключевых момента: использование embedded-базы данных и оптимизация процессов её инициализации и восстановления. Для базового использования достаточно пометить тестовый класс аннотацией `@AutoConfigureEmbeddedDatabase(provider = ZONKY)`.

## О тестировании

Долгое прохождение тестов — явный признак нарушения [пирамиды тестирования](https://martinfowler.com/articles/practical-test-pyramid.html#TheTestPyramid). Проект, где я ускорил тесты, имеет очень мало модульных и очень много интеграционных тестов. Это и стало причиной получения столь значительного эффекта.

Если с пирамидой тестирования всё нормально, то инструменты, подобные Zonky, скорей всего, не принесут желаемого ускорения. В этом случае лучше продолжать использовать популярный и проверенный временем Testcontainers. Если же тяжёлых интеграционных тестов с участием баз данных очень много, то Zonky поможет сэкономить время. Однако последнее я бы воспринимал как инвестицию: сэкономленное время лучше потратить на наведение порядка и выравнивание пирамиды тестирования.

